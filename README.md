# Pioneer AVR LX83 Integration for Home Assistant

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-orange.svg)](https://github.com/custom-components/hacs)
[![GitHub release](https://img.shields.io/github/release/Jackngl/pioneer_avr_lx83.svg)](https://GitHub.com/Jackngl/pioneer_avr_lx83/releases/)
[![License](https://img.shields.io/github/license/Jackngl/pioneer_avr_lx83.svg)](LICENSE)

Custom Home Assistant integration for Pioneer AVR LX83 receivers using Telnet protocol.

## Features

- ✅ Power on/off control
- ✅ Volume control (set, up, down)
- ✅ Mute/unmute
- ✅ Source selection
- ✅ Real-time status updates
- ✅ Config flow UI configuration
- ✅ HACS compatible
- ✅ Uses DataUpdateCoordinator (HA 2025.12+ compliant)

## Installation

### HACS (Recommended)

1. Open HACS in Home Assistant
2. Click on "Integrations"
3. Click the three dots in the top right corner
4. Select "Custom repositories"
5. Add `https://github.com/Jackngl/pioneer_avr_lx83` as repository
6. Select "Integration" as category
7. Click "Add"
8. Search for "Pioneer AVR LX83" and install

### Manual Installation

1. Copy the `custom_components/pioneer_avr_lx83` directory to your Home Assistant's `custom_components` directory
2. Restart Home Assistant

## Configuration

1. Go to Settings > Devices & Services
2. Click "+ Add Integration"
3. Search for "Pioneer AVR LX83"
4. Enter your device's IP address, port (default: 23), and a name
5. Click "Submit"

Once configured, the integration creates **one entity** under the `media_player` domain. This entity can be used in your automations, scripts, and dashboards.

### How to find the exact name of your entity

**Important** : You need to know the exact name of your entity to use it in automations. Here's how to find it:

1. **Method 1 - Via the interface** :
   - Go to **Settings > Devices & Services**
   - Click on your **Pioneer AVR LX83** integration
   - Click on the listed entity (you'll see a `media_player` entity)
   - The full entity name is displayed at the top (e.g., `media_player.pioneer_avr` or `media_player.living_room_amp`)

2. **Method 2 - Via the developer tools** :
   - Go to **Settings > Devices & Services**
   - Click on **ENTITIES** at the top
   - Search for "Pioneer" or the name you gave
   - The entity ID is displayed (e.g., `media_player.pioneer_avr`)

3. **Method 3 - Via logs** :
   - Go to **Settings > System > Logs**
   - Search for integration messages at startup

**Note** : The entity name is automatically generated by Home Assistant from the name you gave during configuration. Spaces are replaced by underscores and everything is lowercase. For example, if you named your device "Living Room Amp", the entity will likely be `media_player.living_room_amp`.

## Supported Sources

- Analog: Phono, CD, Tuner, CDR/Tape, Video 1/2, Multi CH IN
- Digital: DVD, TV/SAT, DVR/BDR, iPod/USB, XM Radio, NET/HMG
- HDMI inputs 1 → 5 (plus HDMI Cycle)
- BD / Blu-ray
- Adapter / Bluetooth port

## Automations

The Pioneer AVR LX83 integration can be used in Home Assistant automations to automate control of your amplifier.

**⚠️ Important** : In all examples below, replace `media_player.pioneer_avr` with the exact name of your entity (see "How to find the exact name of your entity" section above).

Here are some practical examples:

### Example 1: Turn on amplifier when playing music

This automation turns on the amplifier and selects the appropriate source when you start playing music:

```yaml
alias: "Turn on amplifier for music"
description: "Turns on amplifier when music starts"
trigger:
  - platform: state
    entity_id: media_player.spotify  # Replace with your music player
    to: 'playing'
condition: []
action:
  - service: media_player.turn_on
    target:
      entity_id: media_player.pioneer_avr  # ⚠️ REPLACE with your exact entity name
  - delay:
      seconds: 2  # Wait 2 seconds for amplifier to turn on
  - service: media_player.select_source
    target:
      entity_id: media_player.pioneer_avr
    data:
      source: "NET"  # Or "iPod/USB" depending on your source
  - service: media_player.set_volume_level
    target:
      entity_id: media_player.pioneer_avr
    data:
      volume_level: 0.3  # Volume at 30%
mode: single
```

### Example 2: Automatic power off

Turn off the amplifier after a period of inactivity or at a specific time:

```yaml
alias: "Turn off amplifier in evening"
description: "Turns off amplifier at 11:00 PM if on"
trigger:
  - platform: time
    at: "23:00:00"  # 11:00 PM
condition:
  - condition: state
    entity_id: media_player.pioneer_avr  # ⚠️ REPLACE with your exact entity name
    state: 'on'
action:
  - service: media_player.turn_off
    target:
      entity_id: media_player.pioneer_avr
mode: single
```

### Example 3: Adjust volume by time

Automatically reduce volume during quiet hours:

```yaml
alias: "Reduced volume at night"
description: "Reduces volume at 10:00 PM"
trigger:
  - platform: time
    at: "22:00:00"  # 10:00 PM
condition:
  - condition: state
    entity_id: media_player.pioneer_avr  # ⚠️ REPLACE with your exact entity name
    state: 'on'
action:
  - service: media_player.set_volume_level
    target:
      entity_id: media_player.pioneer_avr
    data:
      volume_level: 0.15  # Reduced volume at 15%
mode: single
```

### Example 4: Change source based on TV activity

Automatically change amplifier source when TV turns on:

```yaml
alias: "TV source when TV turns on"
description: "Changes source to TV/Sat when TV turns on"
trigger:
  - platform: state
    entity_id: media_player.tv  # Replace with your TV
    to: 'on'
condition: []
action:
  - service: media_player.turn_on
    target:
      entity_id: media_player.pioneer_avr  # ⚠️ REPLACE with your exact entity name
  - delay:
      seconds: 2
  - service: media_player.select_source
    target:
      entity_id: media_player.pioneer_avr
    data:
      source: "TV/Sat"
mode: single
```

### Example 5: Automatic mute

Activate mute mode during phone calls or important notifications:

```yaml
alias: "Mute during calls"
description: "Activates mute mode during phone calls"
trigger:
  - platform: state
    entity_id: sensor.phone_call_status  # Example sensor
    to: 'ringing'
condition:
  - condition: state
    entity_id: media_player.pioneer_avr  # ⚠️ REPLACE with your exact entity name
    state: 'on'
action:
  - service: media_player.volume_mute
    target:
      entity_id: media_player.pioneer_avr
    data:
      is_volume_muted: true
mode: single
```

### Example 6: Script for "Cinema" scenario

Create a script that configures the amplifier for an optimal cinema experience:

```yaml
script:
  cinema_mode:
    alias: "Cinema Mode"
    sequence:
      - service: media_player.turn_on
        target:
          entity_id: media_player.pioneer_avr
      - delay: "00:00:02"
      - service: media_player.select_source
        target:
          entity_id: media_player.pioneer_avr
        data:
          source: "DVD"
      - service: media_player.set_volume_level
        target:
          entity_id: media_player.pioneer_avr
        data:
          volume_level: 0.4  # Volume at 40%
      - service: media_player.volume_mute
        target:
          entity_id: media_player.pioneer_avr
        data:
          is_volume_muted: false
```

### Available Services

The entity created under the `media_player` domain exposes the following services:

- `media_player.turn_on` : Turn on the amplifier
- `media_player.turn_off` : Turn off the amplifier
- `media_player.volume_up` : Increase volume
- `media_player.volume_down` : Decrease volume
- `media_player.set_volume_level` : Set volume level (0.0 to 1.0)
- `media_player.volume_mute` : Enable/disable mute mode
- `media_player.select_source` : Select input source

### Available States

You can use these states in your automation conditions:

- `state` : `on` or `off`
- `volume_level` : Volume level (0.0 to 1.0)
- `is_volume_muted` : `true` or `false`
- `source` : Currently selected source

## Lovelace Dashboard

You can create a custom dashboard with a virtual remote control to control your Pioneer amplifier. Here is a complete example:

### Example Virtual Remote Control

Create a new dashboard in Home Assistant and add this YAML configuration:

```yaml
type: vertical-stack
cards:
  # Main card with state and on/off control
  - type: media-control
    entity: media_player.pioneer_avr  # Replace with your entity
    
  # Volume control with buttons
  - type: horizontal-stack
    cards:
      - type: button
        name: Volume -
        icon: mdi:volume-minus
        tap_action:
          action: call-service
          service: media_player.volume_down
          target:
            entity_id: media_player.pioneer_avr
      - type: gauge
        entity: media_player.pioneer_avr
        attribute: volume_level
        min: 0
        max: 1
        severity:
          green: 0
          yellow: 0.5
          red: 0.8
        name: Volume
      - type: button
        name: Volume +
        icon: mdi:volume-plus
        tap_action:
          action: call-service
          service: media_player.volume_up
          target:
            entity_id: media_player.pioneer_avr

  # Mute button
  - type: button
    name: Mute
    icon: mdi:volume-mute
    tap_action:
      action: toggle
      service: media_player.volume_mute
      target:
        entity_id: media_player.pioneer_avr
    state:
      - value: 'on'
        styles:
          icon:
            - color: red
      - value: 'off'
        styles:
          icon:
            - color: grey

  # Source selector
  - type: entities
    title: Input Source
    entities:
      - entity: media_player.pioneer_avr
        name: Source
        secondary_info: last-changed

  # Quick source buttons
  - type: grid
    columns: 3
    square: false
    cards:
      - type: button
        name: CD
        icon: mdi:disc-player
        tap_action:
          action: call-service
          service: media_player.select_source
          target:
            entity_id: media_player.pioneer_avr
          data:
            source: CD
      - type: button
        name: DVD
        icon: mdi:disc
        tap_action:
          action: call-service
          service: media_player.select_source
          target:
            entity_id: media_player.pioneer_avr
          data:
            source: DVD
      - type: button
        name: TV/Sat
        icon: mdi:television
        tap_action:
          action: call-service
          service: media_player.select_source
          target:
            entity_id: media_player.pioneer_avr
          data:
            source: TV/Sat
      - type: button
        name: NET
        icon: mdi:network
        tap_action:
          action: call-service
          service: media_player.select_source
          target:
            entity_id: media_player.pioneer_avr
          data:
            source: NET
      - type: button
        name: iPod/USB
        icon: mdi:usb
        tap_action:
          action: call-service
          service: media_player.select_source
          target:
            entity_id: media_player.pioneer_avr
          data:
            source: iPod/USB
      - type: button
        name: Tuner
        icon: mdi:radio
        tap_action:
          action: call-service
          service: media_player.select_source
          target:
            entity_id: media_player.pioneer_avr
          data:
            source: Tuner

  # Device information
  - type: entities
    title: Amplifier Status
    entities:
      - entity: media_player.pioneer_avr
        name: State
      - type: attribute
        entity: media_player.pioneer_avr
        attribute: volume_level
        name: Volume
        unit_of_measurement: '%'
      - type: attribute
        entity: media_player.pioneer_avr
        attribute: source
        name: Current Source
      - type: attribute
        entity: media_player.pioneer_avr
        attribute: is_volume_muted
        name: Mute Mode
```

### Simplified Version with Compact Card

For a more compact remote control, here is a simplified version:

```yaml
type: vertical-stack
cards:
  # Main control card
  - type: media-control
    entity: media_player.pioneer_avr
    
  # Quick controls
  - type: grid
    columns: 4
    square: true
    cards:
      - type: button
        name: ON
        icon: mdi:power
        tap_action:
          action: call-service
          service: media_player.turn_on
          target:
            entity_id: media_player.pioneer_avr
      - type: button
        name: OFF
        icon: mdi:power-off
        tap_action:
          action: call-service
          service: media_player.turn_off
          target:
            entity_id: media_player.pioneer_avr
      - type: button
        name: Mute
        icon: mdi:volume-mute
        tap_action:
          action: toggle
          service: media_player.volume_mute
          target:
            entity_id: media_player.pioneer_avr
      - type: button
        name: Volume
        icon: mdi:volume-high
        tap_action:
          action: more-info
          entity: media_player.pioneer_avr

  # Compact source selector
  - type: button
    entity: media_player.pioneer_avr
    name: Source
    icon: mdi:input-hdmi
    tap_action:
      action: more-info
```

### Important Notes

- Replace `media_player.pioneer_avr` with the actual name of your entity (visible in Settings > Devices & Services)
- To find the exact name of your entity, go to Settings > Devices & Services, click on your Pioneer AVR LX83 integration, then on the entity
- Cards can be customized according to your preferences (colors, icons, layout)
- You can add these cards to an existing dashboard or create a new dedicated dashboard

## Telnet Commands

The integration uses the following Telnet commands:

| Command | Description |
|---------|-------------|
| `PO` | Power On |
| `PF` | Power Off |
| `?P` | Query Power State |
| `VLxxx` | Set Volume (000-185) |
| `?V` | Query Volume |
| `MO` | Mute On |
| `MF` | Mute Off |
| `?M` | Query Mute State |
| `FNxx` | Select Source |
| `?F` | Query Source |

## Testing and Verification

### How to test your integration

Once the integration is configured, here's how to test that everything works correctly:

#### 1. Verify the entity is created

1. Go to **Settings > Devices & Services**
2. Click on your **Pioneer AVR LX83** integration
3. You should see:
   - **1 device** (Pioneer AVR LX83)
   - **1 entity** (media_player)

If you don't see the entity:

- Check the logs (Settings > System > Logs)
- Restart Home Assistant
- Verify that the integration is properly configured (status "Configured")

#### 2. Test services manually

You can test each feature via the developer interface:

1. Go to **Settings > Devices & Services > Developer Tools**
2. Click on the **SERVICES** tab
3. Test the following services:

**Test 1 - Turn on amplifier** :

```yaml
Service: media_player.turn_on
Entity: media_player.pioneer_avr  # Replace with your entity
```

**Test 2 - Turn off amplifier** :

```yaml
Service: media_player.turn_off
Entity: media_player.pioneer_avr
```

**Test 3 - Set volume** :

```yaml
Service: media_player.set_volume_level
Entity: media_player.pioneer_avr
Service Data:
  volume_level: 0.3
```

**Test 4 - Activate mute** :

```yaml
Service: media_player.volume_mute
Entity: media_player.pioneer_avr
Service Data:
  is_volume_muted: true
```

**Test 5 - Change source** :

```yaml
Service: media_player.select_source
Entity: media_player.pioneer_avr
Service Data:
  source: CD
```

#### 3. Check entity state

1. Go to **Settings > Devices & Services > Developer Tools**
2. Click on the **STATES** tab
3. Search for your entity (e.g., `media_player.pioneer_avr`)
4. Check the attributes:
   - `state` : should be `on` or `off`
   - `volume_level` : should be between 0.0 and 1.0
   - `is_volume_muted` : should be `true` or `false`
   - `source` : should display the current source
   - `available` : should be `true` if device is connected

#### 4. Test with a simple script

Create a test script in **Settings > Automations & Scenes > Scripts** :

```yaml
test_pioneer:
  alias: "Test Pioneer AVR"
  sequence:
    - service: media_player.turn_on
      target:
        entity_id: media_player.pioneer_avr  # Replace with your entity
    - delay: "00:00:03"
    - service: media_player.set_volume_level
      target:
        entity_id: media_player.pioneer_avr
      data:
        volume_level: 0.2
    - delay: "00:00:02"
    - service: media_player.select_source
      target:
        entity_id: media_player.pioneer_avr
      data:
        source: CD
    - delay: "00:00:02"
    - service: media_player.volume_mute
      target:
        entity_id: media_player.pioneer_avr
      data:
        is_volume_muted: true
    - delay: "00:00:02"
    - service: media_player.volume_mute
      target:
        entity_id: media_player.pioneer_avr
      data:
        is_volume_muted: false
    - delay: "00:00:02"
    - service: media_player.turn_off
      target:
        entity_id: media_player.pioneer_avr
```

Run this script and verify that each action works on your amplifier.

#### 5. Check logs

If something doesn't work, check the logs:

1. Go to **Settings > System > Logs**
2. Search for messages containing "pioneer" or "avr"
3. Errors will be displayed with the `pioneer_avr_lx83` prefix

### Common issues

#### Entity doesn't appear

- **Solution 1** : Verify that the integration is properly configured and enabled
- **Solution 2** : Restart Home Assistant
- **Solution 3** : Check logs for connection errors
- **Solution 4** : Delete and reconfigure the integration

#### Entity is "unavailable"

- Check network connection between Home Assistant and amplifier
- Verify that Telnet is enabled on the amplifier
- Verify that the IP address is correct
- Test Telnet connection manually from a terminal

#### Commands don't work

- Verify that the amplifier is turned on
- Check logs for errors
- Test each service individually via the developer interface
- Verify that you're using the correct entity name

## Troubleshooting

### Cannot connect to device

- Verify the IP address is correct
- Ensure Telnet is enabled on your Pioneer AVR
- Check that port 23 is not blocked by a firewall
- Verify the device is on the same network

### Device not responding

- Restart the Pioneer AVR
- Restart Home Assistant
- Check network connectivity

## Versioning & Releases

- The integration follows [Semantic Versioning](https://semver.org) and the current version is stored in the `VERSION` file as well as `manifest.json`.
- Run `./scripts/bump_version.py 1.1.0` (replace with the desired number) to update all version references and create a new changelog stub.
- Commit the changes, then tag the release with `git tag -a v1.1.0 -m "Release v1.1.0"` and push the tag (`git push --tags`).
- A GitHub Actions workflow (`.github/workflows/release.yml`) automatically publishes a GitHub release when a `v*` tag is pushed, ensuring HACS can download a human-readable version such as `1.1.0`.

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Credits

Developed by Jack

## Compatibility

- Home Assistant 2023.1.0 or higher
- Compatible with Home Assistant 2025.12 and 2026.01
- Uses modern best practices (DataUpdateCoordinator)

## Support

If you encounter any issues, please [open an issue](https://github.com/Jackngl/pioneer_avr_lx83/issues) on GitHub.
