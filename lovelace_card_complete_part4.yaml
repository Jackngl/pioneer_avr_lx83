  - type: custom:mushroom-title-card
    title: Modes Dolby Pro Logic
    subtitle: Modes Dolby et DTS
  - type: grid
    columns: 3
    square: false
    cards:
      - type: custom:button-card
        entity: media_player.pioneer_avr
        name: Cycle Dolby/DTS
        icon: mdi:sync
        tap_action:
          action: call-service
          service: pioneer_avr_lx83.send_raw_command
          service_data:
            entity_id: media_player.pioneer_avr
            command: 0010SR
        subtitle: |
          Appuyer plusieurs fois pour changer
        state:
          - operator: template
            value: |
              [[[
                var mode = states['media_player.pioneer_avr'].attributes.sound_mode;
                if (!mode) return false;
                var modeLower = mode.toLowerCase().trim();
                return modeLower.includes('pro logic') || modeLower.includes('neo:6') || modeLower.includes('neural');
              ]]]
            styles:
              card:
                - background: "linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)"
                - box-shadow: 0 8px 16px rgba(139, 92, 246, 0.4)
                - transform: scale(1.05)
        styles:
          card:
            - background: "linear-gradient(135deg, #475569 0%, #334155 100%)"
            - border-radius: 20px
            - transition: all 0.3s ease
          name:
            - color: white
            - font-weight: bold
            - font-size: 14px
          icon:
            - color: white
            - width: 32px
      - type: custom:button-card
        entity: media_player.pioneer_avr
        name: PL II Movie
        icon: mdi:movie-open-outline
        tap_action:
          action: call-service
          service: pioneer_avr_lx83.send_raw_command
          service_data:
            entity_id: media_player.pioneer_avr
            command: 0013SR
        state:
          - operator: template
            value: |
              [[[
                var mode = states['media_player.pioneer_avr'].attributes.sound_mode;
                var modeCode = states['media_player.pioneer_avr'].attributes.sound_mode_code;
                if (!mode && !modeCode) return false;
                var modeLower = mode ? mode.toLowerCase().trim() : '';
                var nameMatch = modeLower.includes('pro logic') && modeLower.includes('movie');
                var codeMatch = modeCode && String(modeCode).trim() === '0102';
                return nameMatch || codeMatch;
              ]]]
            styles:
              card:
                - background: "linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)"
                - box-shadow: 0 8px 16px rgba(139, 92, 246, 0.4)
                - transform: scale(1.05)
        styles:
          card:
            - background: "linear-gradient(135deg, #475569 0%, #334155 100%)"
            - border-radius: 20px
            - transition: all 0.3s ease
          name:
            - color: white
            - font-weight: bold
            - font-size: 12px
          icon:
            - color: white
            - width: 32px
      - type: custom:button-card
        entity: media_player.pioneer_avr
        name: PL II Music
        icon: mdi:music-note
        tap_action:
          action: call-service
          service: pioneer_avr_lx83.send_raw_command
          service_data:
            entity_id: media_player.pioneer_avr
            command: 0014SR
        state:
          - operator: template
            value: |
              [[[
                var mode = states['media_player.pioneer_avr'].attributes.sound_mode;
                var modeCode = states['media_player.pioneer_avr'].attributes.sound_mode_code;
                if (!mode && !modeCode) return false;
                var modeLower = mode ? mode.toLowerCase().trim() : '';
                var nameMatch = modeLower.includes('pro logic') && modeLower.includes('music');
                var codeMatch = modeCode && String(modeCode).trim() === '0104';
                return nameMatch || codeMatch;
              ]]]
            styles:
              card:
                - background: "linear-gradient(135deg, #a855f7 0%, #9333ea 100%)"
                - box-shadow: 0 8px 16px rgba(168, 85, 247, 0.4)
                - transform: scale(1.05)
        styles:
          card:
            - background: "linear-gradient(135deg, #475569 0%, #334155 100%)"
            - border-radius: 20px
            - transition: all 0.3s ease
          name:
            - color: white
            - font-weight: bold
            - font-size: 12px
          icon:
            - color: white
            - width: 32px
      - type: custom:button-card
        entity: media_player.pioneer_avr
        name: Dolby Surround
        icon: mdi:surround-sound-5-1
        tap_action:
          action: call-service
          service: pioneer_avr_lx83.send_raw_command
          service_data:
            entity_id: media_player.pioneer_avr
            command: 0151SR
        state:
          - operator: template
            value: |
              [[[
                var mode = states['media_player.pioneer_avr'].attributes.sound_mode;
                var modeCode = states['media_player.pioneer_avr'].attributes.sound_mode_code;
                if (!mode && !modeCode) return false;
                var modeLower = mode ? mode.toLowerCase().trim() : '';
                var nameMatch = modeLower.includes('dolby surround') || (modeLower.includes('dolby') && modeLower.includes('surround'));
                var codeMatch = modeCode && String(modeCode).trim() === '0151';
                return nameMatch || codeMatch;
              ]]]
            styles:
              card:
                - background: "linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)"
                - box-shadow: 0 8px 16px rgba(6, 182, 212, 0.4)
                - transform: scale(1.05)
        styles:
          card:
            - background: "linear-gradient(135deg, #475569 0%, #334155 100%)"
            - border-radius: 20px
            - transition: all 0.3s ease
          name:
            - color: white
            - font-weight: bold
            - font-size: 13px
          icon:
            - color: white
            - width: 32px
      - type: custom:button-card
        entity: media_player.pioneer_avr
        name: Cycle Dolby+THX
        icon: mdi:sync-circle
        tap_action:
          action: call-service
          service: pioneer_avr_lx83.send_raw_command
          service_data:
            entity_id: media_player.pioneer_avr
            command: 0050SR
        subtitle: |
          Appuyer plusieurs fois pour changer
        state:
          - operator: template
            value: |
              [[[
                var mode = states['media_player.pioneer_avr'].attributes.sound_mode;
                var modeCode = states['media_player.pioneer_avr'].attributes.sound_mode_code;
                if (!mode && !modeCode) return false;
                var modeLower = mode ? mode.toLowerCase().trim() : '';
                var codeStr = modeCode ? String(modeCode).trim() : '';
                return codeStr.startsWith('03') && modeLower.includes('thx');
              ]]]
            styles:
              card:
                - background: "linear-gradient(135deg, #dc2626 0%, #991b1b 100%)"
                - box-shadow: 0 8px 16px rgba(220, 38, 38, 0.4)
                - transform: scale(1.05)
        styles:
          card:
            - background: "linear-gradient(135deg, #475569 0%, #334155 100%)"
            - border-radius: 20px
            - transition: all 0.3s ease
          name:
            - color: white
            - font-weight: bold
            - font-size: 12px
          icon:
            - color: white
            - width: 32px
      - type: custom:button-card
        entity: media_player.pioneer_avr
        name: Cycle DSP
        icon: mdi:equalizer
        tap_action:
          action: call-service
          service: pioneer_avr_lx83.send_raw_command
          service_data:
            entity_id: media_player.pioneer_avr
            command: 0100SR
        subtitle: |
          Classical, Rock, Action, etc.
        state:
          - operator: template
            value: |
              [[[
                var mode = states['media_player.pioneer_avr'].attributes.sound_mode;
                var modeCode = states['media_player.pioneer_avr'].attributes.sound_mode_code;
                if (!mode && !modeCode) return false;
                var modeLower = mode ? mode.toLowerCase().trim() : '';
                var codeStr = modeCode ? String(modeCode).trim() : '';
                return codeStr.startsWith('02') && 
                      (modeLower.includes('classical') || modeLower.includes('rock') || 
                       modeLower.includes('action') || modeLower.includes('drama') ||
                       modeLower.includes('sci-fi') || modeLower.includes('sports'));
              ]]]
            styles:
              card:
                - background: "linear-gradient(135deg, #f97316 0%, #ea580c 100%)"
                - box-shadow: 0 8px 16px rgba(249, 115, 22, 0.4)
                - transform: scale(1.05)
        styles:
          card:
            - background: "linear-gradient(135deg, #475569 0%, #334155 100%)"
            - border-radius: 20px
            - transition: all 0.3s ease
          name:
            - color: white
            - font-weight: bold
            - font-size: 12px
          icon:
            - color: white
            - width: 32px